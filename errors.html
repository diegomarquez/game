<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Common Game-Builder Errors</title>
        <link rel="stylesheet" type="text/css" href="styles/override.css">

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
        <script src="bower_components/mustache/mustache.js"></script>
        <script src="bower_components/stringjs/lib/string.js"></script>
        <script id="template" type="x-tmpl-mustache">
            {{#errors}}
                <div class='blue-background'>
                    <hr>
                    <div class="row">
                        {{#docLink}}
                            <a href={{docLink}} name={{name}}>
                                <h4 class="text-center col-md-6 col-md-offset-3">{{humanName}}</h4>
                            </a>
                        {{/docLink}}

                        {{^docLink}}
                            <a name={{name}}>
                                <h4 class="text-center col-md-6 col-md-offset-3">{{humanName}}</h4>
                            </a>
                        {{/docLink}}
                    </div>
                    <hr>
                </div>

                {{#entries}}
                <p class="left-padding right-padding text-center orange-text">{{humanName}} => {{title}}</p>
                <p class="left-padding right-padding">{{description}}</p>
                {{#divider}}
                <hr class="divider">
                {{/divider}}
                {{/entries}}    
            {{/errors}}
        </script>

        <script id="linkTemplate" type="x-tmpl-mustache">
            <a href='{{url}}'><strong class='red-text'>{{linkText}}</strong></a>
        </script>
    </head>
   <body>
        <div class="container">
            <div class="jumbotron">
                <h1 class="text-center" class="page-header">Errors
                    <hr>
                    <small>Common errors thrown by <a href="index.html" >GAME-BUILDER</a> and explanations on why you are seeing them</small>
                </h1>
            </div>
                
            <div id="errorsContainer">
            </div>

            <hr>
            <h6 class="left-padding right-padding footer text-center">Hopefully this is usefull information.</h6>
            <hr>

            <div class="left-padding right-padding footer text-center">
                <p>A project by 
                    <a href="https://github.com/diegomarquez">Diego Enrique Marquez</a>
                </p>
            </div>
        </div>

        <script>
            $(function() {
                var template = $('#template').html();
                var linkTemplate = $(linkTemplate).html();

                Mustache.parse(template);
                Mustache.parse(linkTemplate); 

                var jsonRequests = [];

                jsonRequests.push($.getJSON("errors.json"));
                jsonRequests.push($.getJSON("game-builder-dictionary.json"));

                $.when.apply(this, jsonRequests).then(function(errorData, linksData) {
                    for(var i=0; i<errorData[0].errors.length; i++) {            
                        var error = errorData[0].errors[i];

                        error.humanName = S(error.name).humanize().s;

                        if(error.docLink != "") {
                            error.docLink = error.docLink.replace(error.docLink, linksData[0][error.docLink]);
                        }

                        for(var j=0; j<error.entries.length; j++) {
                            entry = error.entries[j];
                            entry.divider = j < error.entries.length - 1;
                        }
                    }

                    var rendered = Mustache.render(template, errorData[0]);
                    
                    for(var k in linksData[0]) {
                        var htmlLink = Mustache.render(linkTemplate, {url:linksData[0][k], linkText:S(k.replace("@@", "")).humanize().s});    
                        rendered = rendered.replace(new RegExp(k, 'g'), htmlLink);
                    }

                    $('#errorsContainer').html(S(rendered).trim().s);

                    if (location.href.match('#')) {
                        var hashSplit = location.href.split('#');
                        var curHash= hashSplit[1];
                        window.location.hash = curHash;
                    }
                });
            });
        </script>
    </body>
</html>