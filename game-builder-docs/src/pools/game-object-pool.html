<!DOCTYPE html><html lang="en"><head><title>src/pools/game-object-pool</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src/pools/game-object-pool"><meta name="groc-project-path" content="work/game-builder/src/pools/game-object-pool.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/game-builder/src/pools/game-object-pool.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="game-object-pooljs">game-object-pool.js</h1>

<h3 id="bydiegoenriquemarquezhttpwwwtreintipollocom">By <a href="http://www.treintipollo.com">Diego Enrique Marquez</a></h3>

<h3 id="findmeongithubhttpsgithubcomdiegomarquez"><a href="https://github.com/diegomarquez">Find me on Github</a></h3>

<p>Inherits from: <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/pools/pool.html">pool</a></p>

<p>Depends of:</p>

<p>A <a href="http://requirejs.org/">requireJS</a> module. For use with <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a></p>

<p>This module defines the game object pool. All the required instances of <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a>, 
at a certain point in the application, are held here. </p>

<p>The pool can be configured with the types it should hold, and with the maximun amount of each type
it can hold. Note that <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a> that are only configured to be childs, do
not need to have a maximun amount specified, as they will be created as needed.</p>

<p>Only <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a> which are going to be requested explicitly need to specify a 
maximum amount. They will be created dynamically until the maximun is reached.</p>

<p>When the pool reaches the maximun amount of objects it can handle, it will not create
anymore if it is requested. Instead it will throw an error
saying that there are no more <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a> of that type available.</p>

<p>This pool also stores configurations for <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a> instances. 
That means that you can be having a single pooled
object, but with three different configurations, for example. ej.</p>

<pre><code class=" javascript">componentPool.createPool("GameObject", someGameObjectPrototypeObject, 1);

    componentPool.createConfiguration("Conf_1", 'GameObject').args({some_property:  1});
    componentPool.createConfiguration("Conf_2", 'GameObject').args({some_property:2});
    componentPool.createConfiguration("Conf_3", 'GameObject').args({some_property: 3});
</code></pre>

<p>In the example above, there will only be 
a single instance of <em>'someGameObjectPrototypeObject'</em>, but it might be configured with the arguments
for any of those configurations at the moment it is requested.</p>

<p>This is usefull to avoid having too many idling instances at the same time.</p>

<p>Unlike <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/components/component.html">components</a>, there is a bit more to the configuration of a 
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a>.
A configuration might specify, <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/components/component.html">components</a> to attach, child <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a>,
a <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/components/rendering/renderer.html">renderer</a>, aswell as initialization arguments.</p>

<p>The main idea is to provide 
a way to centralize the different configurations for
all the <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a> in a given section of an application. </p>

<p>The good thing of clearly separating configuration from actual usage, is that the code
which will end up using the <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/pools/assembler.html">assembler</a> module to make <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a>
appear on screen, is extremly short.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="pooling">Pooling</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">getComponentDescription</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">componentId</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
      <span class="nx">args</span><span class="o">:</span> <span class="nx">args</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">GameObjectPool</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pool&#39;</span><span class="p">).</span><span class="nx">extend</span><span class="p">({</span>
    </div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>createConfiguration</strong></p>

<p>Creates a configuration for the given type of pooled object.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>alias must be a String.</strong><br/>(The id that will be used to retrieve this configuration)</p></li>
<li><p><strong>type must be a String.</strong><br/>(With this id the configuration has the information needed to know to which pool of objects it refers to)</p></li>
</ul>

<p><strong>Returns an Object</strong><br/>(A configuration object. This objects have a lot of information)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">createConfiguration</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">alias</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Configuration objects for <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a>
contain the arguments that this configuration will apply</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">configuration</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
        <span class="nx">hardArguments</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">childs</span><span class="o">:</span> <span class="p">[],</span>
        <span class="nx">components</span><span class="o">:</span> <span class="p">[],</span>
        <span class="nx">renderer</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns the id of the pool this configuration refers to</p></div></div><div class="code"><div class="wrapper">        <span class="nx">typeId</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">type</span><span class="p">;</span>
        <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set which arguments this configuration will apply to a
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a></p></div></div><div class="code"><div class="wrapper">        <span class="nx">args</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">hardArguments</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add a child, specifying
an existing <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a>
configuration id, and arguments the child will take when initialized</p></div></div><div class="code"><div class="wrapper">        <span class="nx">addChild</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">childId</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">childs</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">childId</span><span class="o">:</span> <span class="nx">childId</span><span class="p">,</span>
            <span class="nx">args</span><span class="o">:</span> <span class="nx">args</span>
          <span class="p">});</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add a <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/components/component.html">component</a>, specifying an existing 
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/components/component.html">component</a> configuration id,
and arguments the component will take when initialized</p></div></div><div class="code"><div class="wrapper">        <span class="nx">addComponent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">componentId</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getComponentDescription</span><span class="p">(</span><span class="nx">componentId</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set a renderer, specifying an existing 
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/components/component.html">component</a> configuration id, and arguments the
renderer will take when initialized</p></div></div><div class="code"><div class="wrapper">        <span class="nx">setRenderer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rendererId</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span> <span class="o">=</span> <span class="nx">getComponentDescription</span><span class="p">(</span><span class="nx">rendererId</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">configurations</span><span class="p">[</span><span class="nx">alias</span><span class="p">]</span> <span class="o">=</span> <span class="nx">configuration</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">configuration</span><span class="p">;</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getName</strong></p>

<p>Get the name of the pool</p>

<p><strong>Returns a String</strong></p></div></div><div class="code"><div class="wrapper">    <span class="nx">getName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;Game Object Pool&#39;</span><span class="p">;</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>addInitialObjectsToPool</strong></p>

<p>Create initial amount of objects of a given type the pool will hold. This
is also the maximun amount of <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-objects</a> of this type
that can be requested explicitly.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>amount must be a Number.</strong><br/>(Amount of intances to create)</p></li>
<li><p><strong>alias must be a String.</strong><br/>(Id refering to the type that should be created)</p></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">addInitialObjectsToPool</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">amount</span><span class="p">,</span> <span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">amount</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">amount</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">createPooledObject</span><span class="p">(</span><span class="nx">alias</span><span class="p">);</span>
      <span class="p">}</span> 

      <span class="k">this</span><span class="p">.</span><span class="nx">pools</span><span class="p">[</span><span class="nx">alias</span><span class="p">].</span><span class="nx">maxAmount</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getConfiguration</strong></p>

<p>Gets a configuration for the requested <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a>.</p>

<p>Parameters:</p>

<ul>
<li><strong>alias must be a String.</strong><br/>(Id of the <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a> requested)</li>
</ul>

<p><strong>Can throw an Error</strong><br/>(If the corresponding pool has no available objects)<br/><strong>and</strong> <strong>Can throw an Error</strong><br/>(If a <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a> type which did not specified a maximun amount is requested explicitly)<br/><strong>and</strong> <strong>Returns an Object</strong><br/>(The configuration object requested)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">getConfiguration</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">alias</span><span class="p">,</span> <span class="nx">nestedCall</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">configuration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getConfigurationObject</span><span class="p">(</span><span class="nx">alias</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">pool</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pools</span><span class="p">[</span><span class="nx">configuration</span><span class="p">.</span><span class="nx">type</span><span class="p">];</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">nestedCall</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">pool</span><span class="p">.</span><span class="nx">maxAmount</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Game Object with type: &#39;</span> <span class="o">+</span> <span class="nx">configuration</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; does not have a value for maxAmount. It can not be requested explicitly&#39;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createNewIfNeeded</span><span class="p">(</span><span class="nx">configuration</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
        
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Game Object with type: &#39;</span> <span class="o">+</span> <span class="nx">configuration</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; is not available&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">configuration</span><span class="p">;</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getConfigurationObject</strong></p>

<p>Gets the requested configuration. It doesn't perform any type of validations.</p>

<p>Parameters:</p>

<ul>
<li><strong>alias must be a String.</strong><br/>(Id of the <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/hierarchy/game-object.html">game-object</a> requested)</li>
</ul>

<p><strong>Can throw an Error</strong><br/>(If the id provided does not match with any existing one)<br/><strong>and</strong> <strong>Returns an Object</strong><br/>(The configuration object requested)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">getConfigurationObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Game Object Pool: &#39;</span> <span class="o">+</span> <span class="s1">&#39;alias argument is: &#39;</span> <span class="o">+</span> <span class="nx">alias</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">configurations</span><span class="p">[</span><span class="nx">alias</span><span class="p">];</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper">  <span class="p">});</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">GameObjectPool</span><span class="p">();</span>
<span class="p">});</span></div></div></div></div></body></html>