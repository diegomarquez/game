<!DOCTYPE html><html lang="en"><head><title>src/sound-player</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/sound-player"><meta name="groc-project-path" content="work/game-builder/src/sound-player.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/game-builder/src/sound-player.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="sound-playerjs">sound-player.js</h1>

<h3 id="bydiegoenriquemarquezhttpwwwtreintipollocom">By <a href="http://www.treintipollo.com">Diego Enrique Marquez</a></h3>

<h3 id="findmeongithubhttpsgithubcomdiegomarquez"><a href="https://github.com/diegomarquez">Find me on Github</a></h3>

<p>Inherits from:
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/delegate.html">delegate</a></p>

<p>Depends of:
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/timers/timer-factory.html">timer-factory</a>
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/asset-preloader.html">asset-preloader</a>
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/debug/error-printer.html">error-printer</a>
<a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/util.html">util</a></p>

<p>A <a href="http://requirejs.org/">requireJS</a> module. For use with <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a></p>

<p>The name is pretty self explanatory, use this module to play some sounds. You can load sound files,
play them, pause them, resume them and stop them. As an additional bonus this is also a manager
that will let you do all the actions described earlier in all the sounds in one method call. Pretty neat.</p>

<p>The first thing to do when using this module is create some channels using the <strong>createChannels</strong> method,
this will dictate the amount of sounds that can be played simultaneously. Of course more sound channels means
a bigger memory foot print.</p>

<p>After creating the channels, it is a matter of adding some sounds files, using the <strong>add</strong> method. After
doing that the <strong>playSingle</strong> and <strong>playLoop</strong> methods will play sound given an id, provided the sound file has already been loaded,
otherwise it will be necessary to wait before playback starts.</p>

<p>To avoid the initial wait consider using the <strong>loadAll</strong> method before playing any sound,
to allow the browser to cache the resources before using them.</p>

<p>The rest of the methods do what they say on the tin</p>

<p>The Sound Player object extends <a href="http://diegomarquez.github.io/game-builder/game-builder-docs/src/delegate.html">delegate</a> so it provides a few events to hook into:</p>

<h3 id="on_load_all_complete"><strong>ON<em>LOAD</em>ALL_COMPLETE</strong></h3>

<p>When loading of resources through the <strong>loadAll</strong> method is complete.</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.ON_LOAD_ALL_COMPLETE, function() {});
</code></pre>

<p></br></p>

<h3 id="on_load_complete"><strong>ON<em>LOAD</em>COMPLETE</strong></h3>

<p>When the loading of a single resource is complete.</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.ON_LOAD_COMPLETE, function(soundId) {});
</code></pre>

<p></br></p>

<h3 id="single_complete"><strong>SINGLE_COMPLETE</strong></h3>

<p>When a <strong>playSingle</strong> call finished playing it's sound</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.SINGLE_COMPLETE, function(soundId) {});
</code></pre>

<p></br></p>

<h3 id="play_single"><strong>PLAY_SINGLE</strong></h3>

<p>When a <strong>playSingle</strong> call starts playback</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.PLAY_SINGLE, function(soundId) {});
</code></pre>

<p></br></p>

<h3 id="play_loop"><strong>PLAY_LOOP</strong></h3>

<p>When a <strong>playLoop</strong> call starts playback</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.PLAY_LOOP, function(soundId) {});
</code></pre>

<p></br></p>

<h3 id="pause"><strong>PAUSE</strong></h3>

<p>When a sound is paused</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.PAUSE, function(soundId) {});
</code></pre>

<p></br></p>

<h3 id="resume"><strong>RESUME</strong></h3>

<p>When a sound is resumed</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.RESUME, function(soundId) {});
</code></pre>

<p></br></p>

<h3 id="stop"><strong>STOP</strong></h3>

<p>When a sound is stopped</p>

<pre><code class=" javascript">soundPlayer.on(soundPlayer.STOP, function(soundId) {});
</code></pre>

<p></br></p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="play-it-loud">Play it loud!</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;delegate&#39;</span><span class="p">,</span> <span class="s1">&#39;timer-factory&#39;</span><span class="p">,</span> <span class="s1">&#39;asset-preloader&#39;</span><span class="p">,</span> <span class="s1">&#39;error-printer&#39;</span><span class="p">,</span> <span class="s1">&#39;util&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Delegate</span><span class="p">,</span> <span class="nx">TimerFactory</span><span class="p">,</span> <span class="nx">AssetPreloader</span><span class="p">,</span> <span class="nx">ErrorPrinter</span><span class="p">,</span> <span class="nx">Util</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">SoundPlayer</span> <span class="o">=</span> <span class="nx">Delegate</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p style='color:#AD071D'><strong>init</strong></p>

<p>Constructor</p></div></div><div class="code"><div class="wrapper">    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span> <span class="o">=</span> <span class="p">{};</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioTagsLoading</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span> <span class="o">=</span> <span class="p">{};</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffersLoading</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">maximumAmountOfBuffers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitAudioContext</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span><span class="p">();</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span> <span class="o">=</span> <span class="p">{};</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">blocked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s2">&quot;suspended&quot;</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>

      <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s2">&quot;suspended&quot;</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>createChannels</strong></p>

<p>Define the amount of sounds that are allowed to be playing at the same time.</p>

<p>Parameters:</p>

<ul>
<li><strong>amount must be a Number.</strong></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">createChannels</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">maximumAmountOfBuffers</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">amount</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>

          <span class="nx">TimerFactory</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="s1">&#39;sound_&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span> <span class="s1">&#39;timer&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Shorthand methods to access the state of the timer used in each channel.</p></div></div><div class="code"><div class="wrapper">          <span class="nx">channel</span><span class="p">.</span><span class="nx">Paused</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Paused</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">channel</span><span class="p">.</span><span class="nx">Playing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Running</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">channel</span><span class="p">.</span><span class="nx">Stopped</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Stopped</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">channel</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">channel</span><span class="p">.</span><span class="nx">stopRequested</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">channel</span><span class="p">.</span><span class="nx">pauseRequested</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getPooledCount</strong></p>

<p><strong>Returns a Number</strong><br/>(Amount of pooled channels)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">getPooledCount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getActiveCount</strong></p>

<p><strong>Returns a Number</strong><br/>(Amount of active channels)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">getActiveCount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getAssignedCount</strong></p>

<p><strong>Returns a Number</strong><br/>(Amount of pre assigned channels)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">getAssignedCount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>add</strong></p>

<p>Define an id for a given path to an audio resource. The id can later be used with
the various methods of the player to manipulate the sound.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>id must be a String.</strong><br/>(Use this identifier to later play the loaded sound)</p></li>
<li><p><strong>path must be a String.</strong><br/>(A path to a sound file. Can be relative or absolute)</p></li>
<li><p><strong>options must be an Object = undefined.</strong><br/>(Various optional options)</p></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Ensure the supported audio format is being used</p></div></div><div class="code"><div class="wrapper">      <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">AssetPreloader</span><span class="p">.</span><span class="nx">convertPathToSupportedAudioFormat</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;web-audio&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;audio-tag&quot;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">v</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">volume</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">volume</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">volume</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
          <span class="nx">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
          <span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
        <span class="nx">dynamic</span><span class="o">:</span> <span class="o">!!</span><span class="nx">o</span><span class="p">.</span><span class="nx">dynamicLoad</span><span class="p">,</span>
        <span class="nx">group</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">group</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">volume</span><span class="o">:</span> <span class="nx">v</span>
      <span class="p">};</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>hasId</strong></p>

<p>Whether or not the sound player has the specified id registered.</p>

<p>Parameters:</p>

<ul>
<li><strong>id must be a String.</strong><br/>(A registered id)</li>
</ul>

<p><strong>Returns a Boolean</strong></p></div></div><div class="code"><div class="wrapper">    <span class="nx">hasId</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>getResourcePath</strong></p>

<p>Get the resource path associated with the specified id.</p>

<p>Parameters:</p>

<ul>
<li><strong>id must be a String.</strong><br/>(A registered id)</li>
</ul>

<p><strong>Returns a Boolean</strong></p></div></div><div class="code"><div class="wrapper">    <span class="nx">getResourcePath</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>assignChannels</strong></p>

<p>Set aside an amount of times a given id can be played at the same time.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>id must be a String.</strong><br/>(Id of the sound that will get channels assigned)</p></li>
<li><p><strong>amount must be a Number.</strong><br/>(Amount of channels to set appart for the given sound)</p></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">assignChannels</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>clearAssignedChannels</strong></p>

<p>Clear the channels asigned to a sound id. Those channels become part of the main pool again and can be used
to dynamically load any other registered sound.</p>

<p>Parameters:</p>

<ul>
<li><strong>id must be a String.</strong><br/>(Id of the sound that has channels assigned)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">clearAssignedChannels</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
          <span class="k">return</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>loadAll</strong></p>

<p>Will load all the sounds that were added previously using <strong>add</strong>.
When all the loading is complete a delegate is executed.</p>

<p><strong>Can throw an Error</strong><br/>(If it is already loading files)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">loadAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ErrorPrinter</span><span class="p">.</span><span class="nx">printError</span><span class="p">(</span><span class="s1">&#39;Sound Player&#39;</span><span class="p">,</span> <span class="s1">&#39;Still loading resources. Wait till everything is complete, before loading more&#39;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">soundAssetCount</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">length</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">soundAssetCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ON_LOAD_ALL_COMPLETE</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">checkAllAssetsLoaded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">soundAssetCount</span><span class="o">--</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">soundAssetCount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ON_LOAD_ALL_COMPLETE</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">id</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">ErrorPrinter</span><span class="p">.</span><span class="nx">printError</span><span class="p">(</span><span class="s1">&#39;Sound Player&#39;</span><span class="p">,</span> <span class="s1">&#39;Id: &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; is already in use&#39;</span><span class="p">);</span>
          <span class="nx">soundAssetCount</span><span class="o">--</span><span class="p">;</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">dynamic</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">dynamic</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">dynamic</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">checkAllAssetsLoaded</span><span class="p">();</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;audio-tag&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">loadAudioTag</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">amound</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">idsToPreAssignOnceLoaded</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
              <span class="kd">var</span> <span class="nx">channels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
              <span class="kd">var</span> <span class="nx">channelsToLoad</span> <span class="o">=</span> <span class="nx">channels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

              <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">channels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">loadChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">channelsToLoad</span><span class="o">--</span><span class="p">;</span>

                  <span class="k">if</span> <span class="p">(</span><span class="nx">channelsToLoad</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">checkAllAssetsLoaded</span><span class="p">();</span>
                  <span class="p">}</span>
                <span class="p">});</span>
              <span class="p">}</span>

              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
              <span class="p">}</span>

              <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">channels</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">checkAllAssetsLoaded</span><span class="p">();</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="nx">AssetPreloader</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;web-audio&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">loadWithWebAudio</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">checkAllAssetsLoaded</span><span class="p">();</span>
          <span class="p">},</span> <span class="nx">AssetPreloader</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>disableNewPlayback</strong></p>

<p>Disable the methods that play sound.</p>

<p>Parameters:</p>

<ul>
<li><strong>remainEnabled can be a String or an Array.</strong><br/>(optional sound ids or group ids that will still be playable)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">disableNewPlayback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">remainEnabled</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">remainEnabled</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">remainEnabled</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">remainEnabled</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">remainEnabled</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">remainEnabled</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">blocked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>enableNewPlayback</strong></p>

<p>Enable the methods that play sound.</p>

<p>Parameters:</p>

<ul>
<li><strong>remainDisabled can be a String or an Array.</strong><br/>(optional sound ids or group ids that will remain blocked)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">enableNewPlayback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">remainDisabled</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">remainDisabled</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">remainDisabled</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">remainDisabled</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">remainDisabled</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">remainDisabled</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">blocked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>playSingle</strong></p>

<p>Plays a sound 1 time.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>id must be a String.</strong><br/>(Id of the sound to play)</p></li>
<li><p><strong>force must be a Boolean = false.</strong><br/>(Force playback if it is blocked)</p></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">playSingle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">force</span><span class="p">,</span> <span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">group</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">group</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">volume</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">volume</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">uniqueId</span> <span class="o">=</span> <span class="nx">uuid</span> <span class="o">?</span> <span class="nx">uuid</span> <span class="o">:</span> <span class="nx">Util</span><span class="p">.</span><span class="nx">generateUUID</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blocked</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">group</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">group</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;audio-tag&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">soundList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">soundList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">getPooledChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">channel</span> <span class="o">&amp;&amp;</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
            <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
            <span class="nx">channel</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

            <span class="nx">playChannelSingle</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">channel</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">onMD</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

              <span class="nx">channel</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;loadedmetadata&#39;</span><span class="p">,</span> <span class="nx">onMD</span><span class="p">);</span>
              <span class="nx">playChannelSingle</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

            <span class="nx">channel</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;loadedmetadata&#39;</span><span class="p">,</span> <span class="nx">onMD</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">loadChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

              <span class="nx">playChannelSingle</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">forcePlayBack</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">blocked</span><span class="p">;</span>

          <span class="nx">loadWithAudioTag</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">playSingle</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">forcePlayBack</span><span class="p">,</span> <span class="nx">uniqueId</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">AssetPreloader</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">uniqueId</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;web-audio&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">maxAmount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">maxAmount</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">maxAmount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maximumAmountOfBuffers</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span> <span class="o">&lt;</span> <span class="nx">maxAmount</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="kd">var</span> <span class="nx">bufferNode</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">createBufferSourceNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">volume</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">createBufferSourceNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">volume</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">bufferNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">pop</span><span class="p">();</span>

            <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">volume</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="p">}</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">bufferNode</span><span class="p">);</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">onEnded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">bufferNode</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">bufferNode</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">SINGLE_COMPLETE</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PLAY_SINGLE</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">forcePlayBack</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">blocked</span><span class="p">;</span>

          <span class="nx">loadWithWebAudio</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">playSingle</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">forcePlayBack</span><span class="p">,</span> <span class="nx">uniqueId</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">AssetPreloader</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">uniqueId</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>playLoop</strong></p>

<p>Plays a sound continuosly, until it is stopped manually.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>id must be a String.</strong><br/>(Id of the sound to play)</p></li>
<li><p><strong>force must be a Boolean = false.</strong><br/>(Force playback if it is blocked)</p></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">playLoop</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">force</span><span class="p">,</span> <span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetPaths</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">group</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">group</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">volume</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">volume</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">uniqueId</span> <span class="o">=</span> <span class="nx">uuid</span> <span class="o">?</span> <span class="nx">uuid</span> <span class="o">:</span> <span class="nx">Util</span><span class="p">.</span><span class="nx">generateUUID</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blocked</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">remainEnabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">group</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">remainDisabled</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">group</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;audio-tag&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">soundList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">soundList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">getPooledChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">channel</span> <span class="o">&amp;&amp;</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
            <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
            <span class="nx">channel</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

            <span class="nx">playChannelLoop</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">channel</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">onMD</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

              <span class="nx">channel</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;loadedmetadata&#39;</span><span class="p">,</span> <span class="nx">onMD</span><span class="p">);</span>
              <span class="nx">playChannelLoop</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

            <span class="nx">channel</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;loadedmetadata&#39;</span><span class="p">,</span> <span class="nx">onMD</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">loadChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
              <span class="nx">channel</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

              <span class="nx">playChannelLoop</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">forcePlayBack</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">blocked</span><span class="p">;</span>

          <span class="nx">loadWithAudioTag</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">playLoop</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">forcePlayBack</span><span class="p">,</span> <span class="nx">uniqueId</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">AssetPreloader</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">uniqueId</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;web-audio&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bufferNode</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">createBufferSourceNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">volume</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">createBufferSourceNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">volume</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">bufferNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">pop</span><span class="p">();</span>

            <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">volume</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">maxAmount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">maxAmount</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">maxAmount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maximumAmountOfBuffers</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span> <span class="o">&lt;</span> <span class="nx">maxAmount</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="p">}</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">=</span> <span class="nx">uniqueId</span><span class="p">;</span>
          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">bufferNode</span><span class="p">);</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">onEnded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">bufferNode</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">pooledBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">bufferNode</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activePreAssignedBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">activeNoneAssignedBuffers</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">onLoop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PLAY_LOOP</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

          <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PLAY_LOOP</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">forcePlayBack</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">blocked</span><span class="p">;</span>

          <span class="nx">loadWithWebAudio</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">playLoop</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">forcePlayBack</span><span class="p">,</span> <span class="nx">uniqueId</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">AssetPreloader</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">uniqueId</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>pause</strong></p>

<p>Pauses all the channels playing a sound with the given id.
If the Id is not found, the passed in argument will be treated as a group id and all sounds sharing it
will be paused.
If the passed is is not a group it will be treated as a unique id that can be used to address a single sound</p>

<p>Parameters:</p>

<ul>
<li><strong>id must be a String.</strong><br/>(Id or group of the sound to pause)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;audio-tag&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;web-audio&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">activeBuffers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">activeBuffers</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">activeBuffers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">activeBuffers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pause</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">channel</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bufferNodes</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">bufferNode</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">bufferNode</span><span class="p">.</span><span class="nx">group</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">bufferNode</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>stop</strong></p>

<p>Stops all the channels playing a sound with the given id.
If the Id is not found, the passed in argument will be treated as a group id and all sounds sharing it
will be stopped.
If the passed is is not a group it will be treated as a unique id that can be used to address a single sound</p>

<p>Parameters:</p>

<ul>
<li><strong>id must be a String.</strong><br/>(Id or group of the sound to stop)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;audio-tag&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;web-audio&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">activeBuffers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">activeBuffers</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">activeBuffers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">activeBuffers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stop</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">channel</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bufferNodes</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">bufferNode</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">bufferNode</span><span class="p">.</span><span class="nx">group</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">bufferNode</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>resume</strong></p>

<p>Resumes all the channels paused with the given id.
If the Id is not found, the passed in argument will be treated as a group id and all sounds sharing it
will be resumed.
If the passed is is not a group it will be treated as a unique id that can be used to address a single sound</p>

<p>Parameters:</p>

<ul>
<li><strong>id must be a String.</strong><br/>(Id or group of the sound to resume)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">resume</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioAssetInfo</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;audio-tag&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">resumeChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;web-audio&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">activeBuffers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">activeBuffers</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">activeBuffers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">activeBuffers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">resume</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">channel</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">group</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">resumeChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">resumeChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bufferNodes</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">bufferNode</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">bufferNode</span><span class="p">.</span><span class="nx">group</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bufferNode</span> <span class="o">=</span> <span class="nx">bufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">bufferNode</span><span class="p">.</span><span class="nx">uuid</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bufferNode</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>pauseAll</strong></p>

<p>Pauses all playing channels registered with the player.</p>

<p><strong>Returns an Object</strong><br/>(A control object with methods to determine which sounds should be paused)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">pauseAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">bulkControl</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;pause&#39;</span><span class="p">);</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>stopAll</strong></p>

<p>Stops all channels registered with the player.</p>

<p><strong>Returns an Object</strong><br/>(A control object with methods to determine which sounds should be stopped)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">stopAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">bulkControl</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">);</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>resumeAll</strong></p>

<p>Resumes all paused channels.</p>

<p><strong>Returns an Object</strong><br/>(A control object with methods to determine which sounds should be resumed)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">resumeAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">bulkControl</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;resume&#39;</span><span class="p">);</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>setProperty</strong></p>

<p>Use this method to add or set a property in all or a subset of the active channels</p>

<p>Parameters:</p>

<ul>
<li><p><strong>property is optional and must be a String.</strong><br/>(Name of the property)</p></li>
<li><p><strong>value is optional and must be an Any.</strong><br/>(Value of the property to add or set)</p></li>
</ul>

<p><strong>Returns an Object</strong><br/>(A control object with methods to determine which sounds should be paused)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">setPropertyToAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">bulkControl</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;setproperty&#39;</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper">  <span class="p">});</span>

  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;ON_LOAD_ALL_COMPLETE&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;load_all_complete&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;ON_LOAD_COMPLETE&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;load_complete&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;CHANNELS_ASSIGN&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;channel_assign&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;CHANNELS_REVOKE&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;channel_revoke&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;SINGLE_COMPLETE&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;single_complete&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;PLAY_SINGLE&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;play_single&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;PLAY_LOOP&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;play_loop&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;PAUSE&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;pause&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;RESUME&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;resume&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">SoundPlayer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;stop&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This object is returned by the <strong>pauseAll</strong>, <strong>stopAll</strong> and <strong>resumeAll</strong>
methods and is used to determine to which channels the specified action whould be applied.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">bulkControl</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The callback function is executed for each active channel
If it returns true the action is applied.
The callback receives the id of the playing
sound and the audio source as arguments</p></div></div><div class="code"><div class="wrapper">      <span class="nx">which</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Handle Audio Objects</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">case</span> <span class="s1">&#39;pause&#39;</span><span class="o">:</span>
                <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;resume&#39;</span><span class="o">:</span>
                <span class="nx">resumeChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;stop&#39;</span><span class="o">:</span>
                <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;setproperty&#39;</span><span class="o">:</span>
                <span class="nx">setProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Handle Audio Buffers</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">activeBufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">activeBufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="s1">&#39;pause&#39;</span><span class="o">:</span>
                  <span class="nx">pauseBuffer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                  <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">&#39;resume&#39;</span><span class="o">:</span>
                  <span class="nx">resumeBuffer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                  <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">&#39;stop&#39;</span><span class="o">:</span>
                  <span class="nx">stopBuffer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                  <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">&#39;setproperty&#39;</span><span class="o">:</span>
                  <span class="nx">setProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                  <span class="k">break</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Use this method to execute the specified action in all the active audio</p></div></div><div class="code"><div class="wrapper">      <span class="nx">now</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Handle Audio Objects</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

          <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;pause&#39;</span><span class="o">:</span>
              <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;resume&#39;</span><span class="o">:</span>
              <span class="nx">resumeChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;stop&#39;</span><span class="o">:</span>
              <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;setproperty&#39;</span><span class="o">:</span>
              <span class="nx">setProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Handle Audio Buffers</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">activeBufferNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">activeBufferNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">activeBufferNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">case</span> <span class="s1">&#39;pause&#39;</span><span class="o">:</span>
                <span class="nx">pauseBuffer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;resume&#39;</span><span class="o">:</span>
                <span class="nx">resumeBuffer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;stop&#39;</span><span class="o">:</span>
                <span class="nx">stopBuffer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="k">case</span> <span class="s1">&#39;setproperty&#39;</span><span class="o">:</span>
                <span class="nx">setProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">pauseBuffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">buffer</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PAUSE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">stopBuffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">buffer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">STOP</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">resumeBuffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">buffer</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">RESUME</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">pauseChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">channel</span><span class="p">.</span><span class="nx">pauseRequested</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">pauseRequested</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
    <span class="nx">channel</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PAUSE</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">stopChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">channel</span><span class="p">.</span><span class="nx">stopRequested</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">stopRequested</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>

      <span class="nx">channel</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">channel</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
    <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">hardCleanUp</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">STOP</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">resumeChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">stopRequested</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">RESUME</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">setProperty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">object</span><span class="p">[</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">loadWithAudioTag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">onComplete</span><span class="p">,</span> <span class="nx">assetPreloader</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">ErrorPrinter</span><span class="p">.</span><span class="nx">printError</span><span class="p">(</span><span class="s1">&#39;Sound Player&#39;</span><span class="p">,</span> <span class="s1">&#39;Id: &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; is already in use&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">loadAudioTag</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">onComplete</span><span class="p">)</span>
        <span class="nx">onComplete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ON_LOAD_COMPLETE</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">assetPreloader</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">loadWithWebAudio</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">onComplete</span><span class="p">,</span> <span class="nx">assetPreloader</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">ErrorPrinter</span><span class="p">.</span><span class="nx">printError</span><span class="p">(</span><span class="s1">&#39;Sound Player&#39;</span><span class="p">,</span> <span class="s1">&#39;Id: &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; is already in use&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioBuffersLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffersLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cachedArrayBuffer</span> <span class="o">=</span> <span class="nx">assetPreloader</span><span class="p">.</span><span class="nx">getCachedAudio</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedArrayBuffer</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">decodeAudioData</span><span class="p">(</span><span class="nx">cachedArrayBuffer</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffersLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">onComplete</span><span class="p">)</span>
          <span class="nx">onComplete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">===</span> <span class="s1">&#39;file:&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5000/&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">request</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s1">&#39;arraybuffer&#39;</span><span class="p">;</span>

      <span class="nx">request</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">decodeAudioData</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">audioBuffersLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">onComplete</span><span class="p">)</span>
            <span class="nx">onComplete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">getPooledChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fromList</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fromList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">fromList</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">loadAudioTag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">onComplete</span><span class="p">,</span> <span class="nx">assetPreloader</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">audioTagsLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
      <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cachedAudioElement</span> <span class="o">=</span> <span class="nx">assetPreloader</span><span class="p">.</span><span class="nx">getCachedAudio</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">audio</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedAudioElement</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">audio</span> <span class="o">=</span> <span class="nx">cachedAudioElement</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioTagsLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cachedAudioElement</span><span class="p">;</span>

      <span class="nx">onComplete</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">audio</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">);</span>

      <span class="nx">audio</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
      <span class="nx">audio</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;preload&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">);</span>

      <span class="nx">audio</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;canplaythrough&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">audioTagsLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="nx">onComplete</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">audioTagsLoading</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">loadChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">onReady</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">audio</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioTags</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">audio</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">onMD</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">channel</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;loadedmetadata&#39;</span><span class="p">,</span> <span class="nx">onMD</span><span class="p">);</span>

      <span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">onReady</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">onReady</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">channel</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;loadedmetadata&#39;</span><span class="p">,</span> <span class="nx">onMD</span><span class="p">);</span>

      <span class="nx">channel</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
      <span class="nx">channel</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span>
      <span class="nx">channel</span><span class="p">.</span><span class="nx">time</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>

      <span class="nx">channel</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>

      <span class="nx">audio</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;canplaythrough&#39;</span><span class="p">,</span> <span class="nx">load</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">audio</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;canplaythrough&#39;</span><span class="p">,</span> <span class="nx">load</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">load</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">playChannelSingle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">soundList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">canPlay</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">channel</span><span class="p">;</span>

      <span class="nx">c</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">SINGLE_COMPLETE</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">stopRequested</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Delay</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">RepeateCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">RemoveOnComplete</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">reset</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PLAY_SINGLE</span><span class="p">,</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">playChannelLoop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">soundList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">preAssignedChannels</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">pooledChannels</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">canPlay</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;repeate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">channel</span><span class="p">;</span>

      <span class="nx">c</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="nx">c</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="nx">c</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">stopRequested</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">c</span><span class="p">));</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PLAY_LOOP</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">channel</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">channel</span><span class="p">.</span><span class="nx">waitingToPlay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">stopRequested</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stopChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pauseChannel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">soundList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">));</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">channel</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Delay</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">RepeateCount</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">RemoveOnComplete</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">reset</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">PLAY_LOOP</span><span class="p">,</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">canPlay</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">originList</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">channel</span><span class="p">.</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">originList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">activeChannels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">createBufferSourceNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">loop</span><span class="p">,</span> <span class="nx">volume</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sourceNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">gainNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">startedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pausedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">buff</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">loop</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">play</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">playing</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">paused</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">pausedAt</span><span class="p">;</span>

      <span class="nx">sourceNode</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createBufferSource</span><span class="p">();</span>
      <span class="nx">gainNode</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createGain</span><span class="p">();</span>

      <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">gainNode</span><span class="p">);</span>
      <span class="nx">gainNode</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">destination</span><span class="p">);</span>

      <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">buffer</span> <span class="o">=</span> <span class="nx">buff</span><span class="p">;</span>
      <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
      <span class="nx">gainNode</span><span class="p">.</span><span class="nx">gain</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

      <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">onended</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">sound</span><span class="p">.</span><span class="nx">onLoop</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sound</span><span class="p">.</span><span class="nx">onLoop</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">sound</span><span class="p">.</span><span class="nx">onEnded</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sound</span><span class="p">.</span><span class="nx">onEnded</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">currentTime</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span>

      <span class="nx">startedAt</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">;</span>
      <span class="nx">pausedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">playing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">resume</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">paused</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

      <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="nx">play</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">pause</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">playing</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">elapsed</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">startedAt</span><span class="p">;</span>
      <span class="nx">paused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">stop</span><span class="p">();</span>
      <span class="nx">paused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">pausedAt</span> <span class="o">=</span> <span class="nx">elapsed</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">stop</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">playing</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">sourceNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
        <span class="nx">sourceNode</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="nx">sourceNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">sound</span><span class="p">.</span><span class="nx">onEnded</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">sound</span><span class="p">.</span><span class="nx">onEnded</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">pausedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">startedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">getCurrentTime</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pausedAt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">pausedAt</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">startedAt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">startedAt</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">getDuration</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">updateBuffer</span><span class="p">(</span><span class="nx">newBuffer</span><span class="p">,</span> <span class="nx">newLoop</span><span class="p">,</span> <span class="nx">volume</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">buff</span> <span class="o">=</span> <span class="nx">newBuffer</span><span class="p">;</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="nx">newLoop</span><span class="p">;</span>
      <span class="nx">v</span> <span class="o">=</span> <span class="nx">volume</span><span class="p">;</span>

      <span class="nx">sourceNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">gainNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">startedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">pausedAt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">sound</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">currentTime</span><span class="o">:</span> <span class="nx">getCurrentTime</span><span class="p">,</span>
      <span class="nx">duration</span><span class="o">:</span> <span class="nx">getDuration</span><span class="p">,</span>
      <span class="nx">play</span><span class="o">:</span> <span class="nx">play</span><span class="p">,</span>
      <span class="nx">pause</span><span class="o">:</span> <span class="nx">pause</span><span class="p">,</span>
      <span class="nx">resume</span><span class="o">:</span> <span class="nx">resume</span><span class="p">,</span>
      <span class="nx">stop</span><span class="o">:</span> <span class="nx">stop</span><span class="p">,</span>
      <span class="nx">onEnded</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">onLoop</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">group</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">uuid</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

      <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">loop</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">updateBuffer</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">loop</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">onEnded</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onLoop</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">},</span>

      <span class="nx">Playing</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">playing</span><span class="p">;</span>
      <span class="p">},</span>

      <span class="nx">Paused</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">paused</span><span class="p">;</span>
      <span class="p">},</span>

      <span class="nx">Stopped</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="nx">sourceNode</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">sound</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">SoundPlayer</span><span class="p">();</span>
<span class="p">});</span></div></div></div></div></body></html>