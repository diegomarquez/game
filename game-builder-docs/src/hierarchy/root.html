<!DOCTYPE html><html lang="en"><head><title>src/hierarchy/root</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src/hierarchy/root"><meta name="groc-project-path" content="work/game-builder/src/hierarchy/root.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/game-builder/src/hierarchy/root.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="rootjs">root.js</h1>

<h3 id="bydiegoenriquemarquezhttpwwwtreintipollocom">By <a href="http://www.treintipollo.com">Diego Enrique Marquez</a></h3>

<h3 id="findmeongithubhttpsgithubcomdiegomarquez"><a href="https://github.com/diegomarquez">Find me on Github</a></h3>

<p>Inherits from: 
<a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/hierarchy/game-object-container.html">game-object-container</a></p>

<p>Depends of:
<a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/view/viewports.html">viewports</a></p>

<p>A <a href="http://requirejs.org/">requireJS</a> module. For use with <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a></p>

<p>This module defines the root <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/hierarchy/game-object-container.html">game-object-container</a></p>

<p>In any given <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a> application
this is is the only <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/hierarchy/game-object-container.html">game-object-container</a> that is updated
explicitly in the main update loop. As it is updated, it will update all of its 
children, who will in turn update their children, until everything has been updated.</p>

<p>Rendering is also executed in this module. The code takes care of setting up the context for each
registered <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/view/viewport.html">viewport</a>. In between setups, all the <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/hierarchy/game-object.html">game-objects</a> for a given
<a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/view/viewport.html">viewport</a> are rendered.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="the-root-of-all-things">The root of all things</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;game-object-container&quot;</span><span class="p">,</span> <span class="s2">&quot;viewports&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Container</span><span class="p">,</span> <span class="nx">Viewports</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">Root</span> <span class="o">=</span> <span class="nx">Container</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">allViewports</span> <span class="o">=</span> <span class="nx">Viewports</span><span class="p">.</span><span class="nx">all</span><span class="p">();</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;game&#39;</span><span class="p">);</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>draw</strong></p>

<p>Performs the rendering of all the <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/view/viewport.html">viewports</a> registered in the <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/view/viewports.html">viewports</a> object.</p>

<p>The process includes, clearing the rectangle belonging to each viewport, modifying the context and drawing all
the corresponding <a href="file://localhost/Users/johndoe/game-builder-gh-pages/game-builder-docs/src/hierarchy/game-object.html">game-objects</a></p>

<p>Parameters:</p>

<ul>
<li><strong>context must be a Context 2D.</strong><br/>(<a href="http://www.w3.org/html/wg/drafts/2dcontext/html5_canvas/">Canvas 2D context</a>)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Clear the canvas</p></div></div><div class="code"><div class="wrapper">      <span class="nx">context</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">allViewports</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">allViewports</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Skip everything if the viewport is not visible</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">v</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Save state for current viewport</p></div></div><div class="code"><div class="wrapper">        <span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
        </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This simulates a strokes that grows outwards</p></div></div><div class="code"><div class="wrapper">            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span> <span class="o">||</span> <span class="nx">v</span><span class="p">.</span><span class="nx">strokeColor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
          <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">strokeColor</span><span class="p">;</span>

              <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">offsetX</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetY</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">width</span><span class="o">+</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">);</span>
              <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">offsetX</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetY</span><span class="o">+</span><span class="nx">v</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">width</span><span class="o">+</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">);</span>
              <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">offsetX</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetY</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">height</span><span class="o">+</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="o">*</span><span class="mi">2</span><span class="p">));</span>
              <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">offsetX</span><span class="o">+</span><span class="nx">v</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetY</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">height</span><span class="o">+</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="o">*</span><span class="mi">2</span><span class="p">));</span>

          <span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>            
            <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the clipping area</p></div></div><div class="code"><div class="wrapper">        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
            <span class="nx">context</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
            <span class="nx">context</span><span class="p">.</span><span class="nx">clip</span><span class="p">();</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
            </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>make all the drawings relative to the viewport's visible area</p></div></div><div class="code"><div class="wrapper">          <span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">);</span>
          <span class="nx">context</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">scaleX</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">scaleY</span><span class="p">);</span>
        </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Draw all the game objects associated with this viewport</p></div></div><div class="code"><div class="wrapper">          <span class="nx">v</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Go back to previous state for the next viewport</p></div></div><div class="code"><div class="wrapper">          <span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">Root</span><span class="p">();</span>
<span class="p">});</span></div></div></div></div></body></html>