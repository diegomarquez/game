<!DOCTYPE html><html lang="en"><head><title>src/collision/collision-resolver</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src/collision/collision-resolver"><meta name="groc-project-path" content="work/game-builder/src/collision/collision-resolver.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/game-builder/src/collision/collision-resolver.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="collision-resolverjs">collision-resolver.js</h1>

<h3 id="bydiegoenriquemarquezhttpwwwtreintipollocom">By <a href="http://www.treintipollo.com">Diego Enrique Marquez</a></h3>

<h3 id="findmeongithubhttpsgithubcomdiegomarquez"><a href="https://github.com/diegomarquez">Find me on Github</a></h3>

<p>Inherits from:</p>

<p>Depends of: 
<a href="http://localhost:5000/game-builder-docs/src/collision/sat.html">sat</a></p>

<p>A <a href="http://requirejs.org/">requireJS</a> module. For use with <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a></p>

<p>This organizes the colliders into pairs of groups. The first collection of each pair, is tested against
the second collection for colliders. There isn't much more to it.</p>

<p>Worth noting is that the module only checks for overlaps, there is no projection. For the type
of projects <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a> attempts to tackle, it should
be enough. </p>

<p>Also important is the fact there is no 
<a href="http://www.htmlgoodies.com/html5/client/broad-phase-collision-detection-using-spatial-partitioning.html#fbid=fsD5-BRjvS-">broad-phase</a> 
of any kind in this collision detection system.
Again this shouldn't be too much of a problem for simple stuff. </p>

<p>You could always implement a better collision system if you know how to,
as all things regarding collision detection are not coupled in anyway to the core of <a href="http://diegomarquez.github.io/game-builder">Game-Builder</a>
But I think that for prototypes is largely unnecessary.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="resolve-collisions">Resolve collisions</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;sat&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">SAT</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">CollisionResolver</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collisionLists</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">toCollideCache</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>addToCollisionList</strong></p>

<p>Adds a component to a collision list.</p>

<p>The component is added to the correponding lists, depending on it's collision id.</p>

<p>Parameters:</p>

<ul>
<li><strong>collisionComponent must be an Object.</strong><br/>(An object extending <a href="http://localhost:5000/game-builder-docs/src/collision/collision-component.html">collision-component</a>)</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addToCollisionList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collisionComponent</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toCollideCache</span><span class="p">[</span><span class="nx">collisionComponent</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">indexes</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">indexes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">indexes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collisionLists</span><span class="p">[</span><span class="nx">indexes</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">collisionComponent</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>removeFromCollisionList</strong></p>

<p>Removes a component from a collision list.</p>

<p>The component is removed from the corresponding lists, depending on it's collision id.</p>

<p>Parameters:</p>

<ul>
<li><strong>collisionComponent must be an Obejct.</strong><br/>(An object extending <a href="http://localhost:5000/game-builder-docs/src/collision/collision-component.html">collision-component</a>)</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeFromCollisionList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collisionComponent</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toCollideCache</span><span class="p">[</span><span class="nx">collisionComponent</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">indexes</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">indexes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">indexes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">m</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collisionLists</span><span class="p">[</span><span class="nx">indexes</span><span class="p">[</span><span class="nx">m</span><span class="p">]].</span><span class="nx">splice</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collisionLists</span><span class="p">[</span><span class="nx">indexes</span><span class="p">[</span><span class="nx">m</span><span class="p">]].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">collisionComponent</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>addCollisionPair</strong></p>

<p>Use this method to setup collision pairs.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>first must be a String.</strong><br/>(The collidionId of the first group in the pair)</p></li>
<li><p><strong>second must be a String.</strong><br/>(The collidionId of the first group in the pair)</p></li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addCollisionPair</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collisionLists</span><span class="p">[</span><span class="nx">first</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">collisionLists</span><span class="p">[</span><span class="nx">first</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toCollideCache</span><span class="p">[</span><span class="nx">second</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">toCollideCache</span><span class="p">[</span><span class="nx">second</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">toCollideCache</span><span class="p">[</span><span class="nx">second</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">first</span><span class="p">);</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p style='color:#AD071D'><strong>areColliding</strong></p>

<p>This is the actual method that does the magic.</p>

<p>This method will make the appropiate tests according to the type of the colliders involved.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>first must be an Object.</strong><br/>(The first <a href="http://localhost:5000/game-builder-docs/src/collision/collision-component.html">collision-component</a> in the test)</p></li>
<li><p><strong>second must be an Object.</strong><br/>(The second <a href="http://localhost:5000/game-builder-docs/src/collision/collision-component.html">collision-component</a> in the test)</p></li>
</ul>

<p><strong>Returns a Boolean</strong><br/>(Whether there was a collision)</p></div></div><div class="code"><div class="wrapper">  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">areColliding</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">collider</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">second</span><span class="p">.</span><span class="nx">collider</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="nx">second</span><span class="p">.</span><span class="nx">colliderType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">circleCollider</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">SAT</span><span class="p">.</span><span class="nx">testCircleCircle</span><span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">collider</span><span class="p">,</span> <span class="nx">second</span><span class="p">.</span><span class="nx">collider</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">polygonCollider</span> <span class="o">||</span> <span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">fixedPolygonCollider</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">SAT</span><span class="p">.</span><span class="nx">testPolygonPolygon</span><span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">collider</span><span class="p">,</span> <span class="nx">second</span><span class="p">.</span><span class="nx">collider</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">circleCollider</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">SAT</span><span class="p">.</span><span class="nx">testPolygonCircle</span><span class="p">(</span><span class="nx">second</span><span class="p">.</span><span class="nx">collider</span><span class="p">,</span> <span class="nx">first</span><span class="p">.</span><span class="nx">collider</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">polygonCollider</span> <span class="o">||</span> <span class="nx">first</span><span class="p">.</span><span class="nx">colliderType</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">fixedPolygonCollider</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">SAT</span><span class="p">.</span><span class="nx">testPolygonCircle</span><span class="p">(</span><span class="nx">first</span><span class="p">.</span><span class="nx">collider</span><span class="p">,</span> <span class="nx">second</span><span class="p">.</span><span class="nx">collider</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>These variables are used by the concrete implementations of colliders to decide what
type of collider they are, and hence, which method should be used when checking for collisions
between them.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">circleCollider</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">polygonCollider</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="nx">CollisionResolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fixedPolygonCollider</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">CollisionResolver</span><span class="p">();</span>
<span class="p">});</span></div></div></div></div></body></html>