<!DOCTYPE html><html lang="en"><head><title>layering/main</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="layering/main"><meta name="groc-project-path" content="work/examples/layering/main.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/examples/layering/main.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="layerings-main-entry-point">layering's main entry point</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="modules-at-work-in-this-example">Modules at work in this example</h3>

<p><a href="@@gb@@">gb</a>
<a href="@@game@@">game</a>
<a href="@@root@@">root</a>
<a href="@@layers@@">layers</a>
<a href="@@basic-layer-setup@@">basic-layer-setup</a>
<a href="http://diegomarquez.github.io/game-builder/examples-docs/common_src/bundles/nesting-bundle.html">layering-bundle</a>
<a href="@@keyboard@@">keyboard</a></p></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">gb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gb&#39;</span><span class="p">);</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Storing some references to avoid excesive typing</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">game</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">layers</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">layers</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">keyboard</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;keyboard&#39;</span><span class="p">);</span>

  <span class="nx">game</span><span class="p">.</span><span class="nx">add_extension</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;basic-layer-setup&#39;</span><span class="p">));</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main initialization function</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">CREATE</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Welcome to Game-Builder!&quot;</span><span class="p">);</span>

    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;layering-bundle&#39;</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Each <a href="@@game-object@@">game-object</a> is added to a different <a href="@@layer@@">layer</a></p></div></div><div class="code"><div class="wrapper">    <span class="nx">gb</span><span class="p">.</span><span class="nx">addToLayer</span><span class="p">(</span><span class="s1">&#39;Front&#39;</span><span class="p">,</span> <span class="s1">&#39;Base_3&#39;</span><span class="p">);</span>
    <span class="nx">gb</span><span class="p">.</span><span class="nx">addToLayer</span><span class="p">(</span><span class="s1">&#39;Middle&#39;</span><span class="p">,</span> <span class="s1">&#39;Base_2&#39;</span><span class="p">);</span>
    <span class="nx">gb</span><span class="p">.</span><span class="nx">addToLayer</span><span class="p">(</span><span class="s1">&#39;Back&#39;</span><span class="p">,</span> <span class="s1">&#39;Base_1&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>These are used to add back the stuff to the layers if you
remove them while trying out the example.
Check out the errors that are printed on console when there are no more <a href="@@game-object@@">game-objects</a>
available in the pools. These won't break the app by themselves, but if you see them
in your own work, there probably is something fishy going on.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">NUM_1</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">gb</span><span class="p">.</span><span class="nx">addToLayer</span><span class="p">(</span><span class="s1">&#39;Front&#39;</span><span class="p">,</span> <span class="s1">&#39;Base_3&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">NUM_2</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">gb</span><span class="p">.</span><span class="nx">addToLayer</span><span class="p">(</span><span class="s1">&#39;Middle&#39;</span><span class="p">,</span> <span class="s1">&#39;Base_2&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">NUM_3</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">gb</span><span class="p">.</span><span class="nx">addToLayer</span><span class="p">(</span><span class="s1">&#39;Back&#39;</span><span class="p">,</span> <span class="s1">&#39;Base_1&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Stop calling update method on game objects on the 'Front' layer
Effectively pausing that layer.</p></div></div><div class="code"><div class="wrapper">      <span class="nx">layers</span><span class="p">.</span><span class="nx">stop_update</span><span class="p">(</span><span class="s1">&#39;Front&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">S</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Stop calling draw method on game objects on the 'Front' layer
Effectively making the layer invisible.</p></div></div><div class="code"><div class="wrapper">      <span class="nx">layers</span><span class="p">.</span><span class="nx">stop_draw</span><span class="p">(</span><span class="s1">&#39;Front&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">D</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Resume all activity on the 'Front'  layer</p></div></div><div class="code"><div class="wrapper">      <span class="nx">layers</span><span class="p">.</span><span class="nx">resume</span><span class="p">(</span><span class="s1">&#39;Front&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">Z</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Clear all layers of game objects</p></div></div><div class="code"><div class="wrapper">      <span class="nx">layers</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">);</span>
    <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>When a layer is removed it is gone for good, trying to add things
to it later will result in an error, printed in console. You can try it out, by adding
things to any of the layers after calling this method.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Remove all layers entirely. You will need to add more layers after doing this.</p></div></div><div class="code"><div class="wrapper">      <span class="nx">layers</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is called when the canvas looses focus</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">BLUR</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;layering has lost focus&quot;</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is called when the canvas regains focus</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">FOCUS</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;layering has regained focus&quot;</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main update loop</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">UPDATE</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Updates ALL the things.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">root</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">delta</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Draws ALL the things.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">root</span><span class="p">.</span><span class="nx">transformAndDraw</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">context</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main setup that kicks off the whole thing
Notice how it needs to find a '#main' and '#game' in the document</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">),</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;game&#39;</span><span class="p">));</span>
<span class="p">});</span></div></div></div></div></body></html>