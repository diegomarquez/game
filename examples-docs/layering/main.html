<!DOCTYPE html><html lang="en"><head><title>layering/main</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="layering/main"><meta name="groc-project-path" content="work/examples/layering/main.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/examples/layering/main.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h3 id="bydiegoenriquemarquezhttpwwwtreintipollocom">By <a href="http://www.treintipollo.com">Diego Enrique Marquez</a></h3>

<h3 id="findmeongithubhttpsgithubcomdiegomarquez"><a href="https://github.com/diegomarquez">Find me on Github</a></h3>

<p>Depends of:
<a href="@@gb@@">gb</a>,
<a href="@@game@@">game</a>,
<a href="@@groups@@">groups</a>,
<a href="@@basic-display-setup@@">basic-display-setup</a>,
<a href="@@activity-display@@">activity-display</a>,
<a href="@@prevent-keys-default@@">prevent-keys-default</a>,
<a href="http://diegomarquez.github.io/game-builder/examples-docs/common_src/bundles/nesting-bundle.html">layering-bundle</a>,
<a href="@@keyboard@@">keyboard</a></p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr /></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">gb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gb&#39;</span><span class="p">);</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Storing some references to avoid excesive typing</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">game</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">groups</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">groups</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">keyboard</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;keyboard&#39;</span><span class="p">);</span>

  <span class="nx">game</span><span class="p">.</span><span class="nx">add_extension</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;basic-display-setup&#39;</span><span class="p">));</span>
  <span class="nx">game</span><span class="p">.</span><span class="nx">add_extension</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;activity-display&quot;</span><span class="p">));</span>
  <span class="nx">game</span><span class="p">.</span><span class="nx">add_extension</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;prevent-keys-default&quot;</span><span class="p">));</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main initialization function</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">CREATE</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Welcome to Game-Builder!&quot;</span><span class="p">);</span>

    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;layering-bundle&#39;</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Each <a href="@@game-object@@">game-object</a> is added to a different updating
<a href="@@group@@">group</a> and to a different <a href="@@layer@@">layer</a> of the same <a href="@@viewport@@">viewport</a>
The third argument is defined in <a href="@@basic-display-setup@@">basic-display-setup</a></p></div></div><div class="code"><div class="wrapper">    <span class="nx">gb</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Base_3&#39;</span><span class="p">,</span> <span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="s1">&#39;MainBack&#39;</span><span class="p">);</span>
    <span class="nx">gb</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Base_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMiddle&#39;</span><span class="p">);</span>
    <span class="nx">gb</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Base_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Third&#39;</span><span class="p">,</span> <span class="s1">&#39;MainFront&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>These are used to add back the stuff for update and rendering if you
remove them while trying out the example.
Check out the errors that are printed on console when there are no more <a href="@@game-object@@">game-objects</a>
available in the <a href="@@pool@@">pools</a>. These won't break the app by themselves, but if you see them
in your own work, there probably is something fishy going on.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">NUM_1</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">gb</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Base_3&#39;</span><span class="p">,</span> <span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="s1">&#39;MainBack&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">NUM_2</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">gb</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Base_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMiddle&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">NUM_3</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">gb</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Base_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Third&#39;</span><span class="p">,</span> <span class="s1">&#39;MainFront&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Stop calling update method on <a href="@@game-object@@">game-objects</a> on the 'Third' <a href="@@group@@">group</a></p></div></div><div class="code"><div class="wrapper">      <span class="nx">groups</span><span class="p">.</span><span class="nx">stop_update</span><span class="p">(</span><span class="s1">&#39;Third&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">S</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Stop calling draw method on <a href="@@game-object@@">game-objects</a> on the 'Third' <a href="@@group@@">group</a></p></div></div><div class="code"><div class="wrapper">      <span class="nx">groups</span><span class="p">.</span><span class="nx">stop_draw</span><span class="p">(</span><span class="s1">&#39;Third&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">D</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Resume all activity on the 'Third' <a href="@@group@@">group</a></p></div></div><div class="code"><div class="wrapper">      <span class="nx">groups</span><span class="p">.</span><span class="nx">resume</span><span class="p">(</span><span class="s1">&#39;Third&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">Z</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Clear all layers of game objects</p></div></div><div class="code"><div class="wrapper">      <span class="nx">groups</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">);</span>
    <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>When a layer is removed it is gone for good, trying to add things
to it later will result in an error, printed in console. You can try it out, by adding
things to any of the layers after calling this method.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Remove all layers entirely. You will need to add more layers after doing this.</p></div></div><div class="code"><div class="wrapper">      <span class="nx">groups</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is called when the canvas looses focus</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">BLUR</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;layering has lost focus&quot;</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is called when the canvas regains focus</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">FOCUS</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;layering has regained focus&quot;</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main update loop</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">UPDATE</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Do stuff here that needs constant updating</p></div></div><div class="code"><div class="wrapper">    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this.delta => Time delta between updates
this.context => 2D Context where stuff is drawn</p></div></div><div class="code"><div class="wrapper">  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main setup that kicks off the whole thing</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="p">});</span></div></div></div></div></body></html>