<!DOCTYPE html><html lang="en"><head><title>timers/main</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="timers/main"><meta name="groc-project-path" content="work/examples/timers/main.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">work/examples/timers/main.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>timers's main entry point </p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="modules-at-work-in-this-example">Modules at work in this example</h3>

<p><a href="@@gb@@">gb</a>
<a href="@@game@@">game</a>
<a href="@@root@@">root</a>
<a href="@@timer-factory@@">timer-factory</a>
<a href="@@keyboard@@">keyboard</a></p></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">gb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gb&#39;</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">game</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">gb</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">timer_factory</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;timer-factory&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">keyboard</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;keyboard&#39;</span><span class="p">);</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main initialization function</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">CREATE</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Welcome to Game-Builder!&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create and configure a fresh batch of timers</p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">Z</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Create timers&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Making sure we have a clean slate each time</p></div></div><div class="code"><div class="wrapper">      <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">removeAll</span><span class="p">().</span><span class="nx">now</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Creating the timers
This creates a timer object, it has 3 arguments
1) It becomes part of the scope 'this' (or any other scope passed), 
2) It belongs to the group 'timer<em>1'
3) And can be accessed in the scope specified in 1) through the name 'my</em>timer' </p></div></div><div class="code"><div class="wrapper">      <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;timer_1&#39;</span><span class="p">,</span> <span class="s1">&#39;my_timer_1&#39;</span><span class="p">);</span>
      <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;timer_1&#39;</span><span class="p">,</span> <span class="s1">&#39;my_timer_2&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Configuring the timers</p></div></div><div class="code"><div class="wrapper">      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_1</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span> <span class="nx">delay</span><span class="o">:</span> <span class="mi">3000</span> <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span> <span class="nx">delay</span><span class="o">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="nx">repeatCount</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="nx">removeOnComplete</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
    <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Bring up your javascript console to view when stuff gets printed.
It's pretty lame, but the example goes off scope otherwise.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The most basic timer, after running once, it is destroyed never to be seen again.
Being destroyed means it is removed from the factory cache, and removed from the owner.
Trying to access it again after it is complete would just break things.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">my_timer_1</span><span class="p">)</span> <span class="k">return</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Start the timer</p></div></div><div class="code"><div class="wrapper">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;my_timer_1 started&#39;</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total timer amount in factory: &#39;</span> <span class="o">+</span> <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">timeOuts</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_1</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This callback will be called when the repeate count reaches 0
The scope of this callback is the one specified when creating the timer with timer_factory.get</p></div></div><div class="code"><div class="wrapper">      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;my_timer_1 completed and destroyed&#39;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total timer amount in factory: &#39;</span> <span class="o">+</span> <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">timeOuts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This timer will not be destroyed when it completes.
That means it can be restarted and it's properties changed.
In this case it is re-used as a one shot timer.            </p></div></div><div class="code"><div class="wrapper">    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onKeyDown</span><span class="p">(</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">S</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">)</span> <span class="k">return</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;my_timer_2 started&#39;</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total timer amount in factory: &#39;</span> <span class="o">+</span> <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">timeOuts</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;repeate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repeatCount</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;my_timer_2 repeat count: &#39;</span> <span class="o">+</span> <span class="nx">repeatCount</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;my_timer_2 completed&#39;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total timer amount in factory: &#39;</span> <span class="o">+</span> <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">timeOuts</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Re configure</p></div></div><div class="code"><div class="wrapper">        <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span> <span class="nx">delay</span><span class="o">:</span> <span class="mi">5000</span><span class="p">,</span> <span class="nx">repeatCount</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">removeOnComplete</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
      <span class="p">});</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">my_timer_2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;my_timer_2 completed and destroyed&#39;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total timer amount in factory: &#39;</span> <span class="o">+</span> <span class="nx">timer_factory</span><span class="p">.</span><span class="nx">timeOuts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is called when the canvas looses focus</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">BLUR</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;timers has lost focus&quot;</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is called when the canvas regains focus</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">FOCUS</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;timers has regained focus&quot;</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main update loop</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">UPDATE</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Updates ALL the things.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">root</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">delta</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Draws ALL the things.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">root</span><span class="p">.</span><span class="nx">transformAndDraw</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">context</span><span class="p">);</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the main setup that kicks off the whole thing
Notice how it needs to find a '#main' and '#game' in the document</p></div></div><div class="code"><div class="wrapper">  <span class="nx">game</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">),</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;game&#39;</span><span class="p">));</span>
<span class="p">});</span></div></div></div></div></body></html>